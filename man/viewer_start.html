<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<link rel="stylesheet" type="text/css" href="prj.css"/>
<title>ビューアの起動</title>
</head>

<body>

<p align="center"><h1>ビューアの起動</h1>
<p>　</p>
<ul>
  <li><a href="#ビューワーの起動">ビューアの起動</a></li>
  <ul>
	<li><a href="#コマンドライン起動オプション">コマンドライン起動オプション</a></li>
	<li><a href="#設定ファイル">設定ファイル</a></li>
	<li><a href="#Java VM設定ファイル">Java VM設定ファイル</a></li>
  </ul>
  <li>補足事項</li>
  <ul>
	  <li><a href="#ファイアーウォール越え">ビューワーのサービスプロバイダ機能をファイアーウォールを越えて使う方法</a></li>
  </ul>
</ul>
<p>
</p>

<p>
<a name="ビューワーの起動"><h2>ビューアの起動
</h2></a><br>
SIGViewer.exeを実行します．

<p>
初回起動時のみ、以下のダイアログが表示されます．

<p align="center">
<img border="0" src="viewer1.jpg" width="500" height="464">

<p>
これは、レンダリングに使うグラフィックス環境の設定を行うダイアログです．
OpenGL/Direct3D9のどちらのレンダリングサブシステムを使うかを選んでください．
（どちらを選んでも構いませんが、通常はOpenGLを選べばいいと思います）

<p>
<h3>
（注意）
このとき、ダイアログ中の「FullScreen」の設定を必ず「No」にしてください．
</h3>
</p>

<p>
（注）
この設定はogre.cfgに保存されます．次回起動したときはこの設定が使われますので、2回目からはこのダイアログは開きません．

<p>
もし設定を変えたい場合は、ogre.cfgファイルを消してから、再度SIGViewer.exeを起動してください．（再び設定ダイアログが開きます）

<br>
<p>
「Ok」を押すと、設定を保存し、ビューアが起動されます．
<br>
<p align="center">
<img border="0" src="viewer2.jpg" width="800" height="600">



<br><br><br>
<a name="コマンドライン起動オプション"><h3>コマンドライン起動オプション
</h3></a>
<font class="example1"><b>-s hostname<br>
</b></font>シミュレーションサーバのホスト名を指定します．デフォルトではlocalhostになっています．<br>
<br>
<b><font class="example1">-p portno<br>
</font></b>シミュレーションサーバのポート番号を指定します．デフォルトでは7000番になっています．<br>
<br>
<b><font class="example1">-sp portno<br>
</font></b>サービスプロバイダとしてビューアがオープンするポート番号を指定します．デフォルトでは8000番になっています．<br>
<br>
（例）<p>シミュレーションサーバがmyserver.co.jp、ポート番号を7500番とする場合は以下のように指定します．<br>
<br>
<font class="example1">> <b> SIGViewer &#8211;s myserver.co.jp &#8211;p 7500</b><br>
</font><br>
<br>
<br><br><br>
<a name="設定ファイル"><h3>設定ファイル
</h3></a>
startup.cfgがSIGViewer.exeと同じディレクトリにある場合、起動時にそれを設定ファイルとして読み込みます．<p>
シミュレーションサーバのホスト名、ポート番号、その他のオプションをあらかじめ設定しておけば、起動するたびにコマンドラインオプションで指定する手間が省けます．<br>
<br>
<br>
設定できる項目<br>
<br>

<b>SERVER<br>
</b>シミュレーションサーバのホスト名を指定します．<br>
<br>
ホスト名は複数個指定できます．指定されたホスト名はメインウィンドウ下部のserver host nameエリアのドロップダウンリストに表示されます．<br>
指定しない場合はlocalhostになります．<br>
<br>


<b>PORT<br>
</b>シミュレーションサーバのポート番号を指定します．<br>
<br>
ポート番号は複数個指定できます．指定されたポート番号はメインウィンドウ下部のserver port Noエリアのドロップダウンリストに表示されます．<br>
指定しない場合は7000番になります．<br>
<br>


<b>VIEWER_AS_SERVICE_PROVIDER<br></b>
ビューアを、detectEntities, captureViewサービスを提供するサービスプロバイダとして動作させるかどうかを指定します．<br>
この項目を指定しなかった場合はtrue（＝サービスプロバイダとして動作させる）になります．<br>
<br>


<b>SERVICE_PROVIDER_HOST<br></b>
サービスプロバイダとしてサーバーに登録するIPアドレスを指定します．<br>
コントローラがビューアにdetectEntitiesのようなサービスを依頼した場合、
ここに書かれたアドレスへ接続されます．<br>
この項目を指定しなかった場合は、自動的にビューアを実行しているPCのホストアドレスになります．<br>
<br>


<b>SERVICE_PROVIDER_PORT<br></b>
サービスプロバイダとしてビューアがオープンするポート番号を指定します．この項目を指定しなかった場合は8000番になります．<br>
<br>


<b>MAIN_CAMERA_INIT_POS<br>
</b>起動時のメインカメラの位置を指定します．<br>
<br>


<b>MAIN_CAMERA_INIT_DIR<br>
</b>
起動時のメインカメラの視線方向を指定します．<br>
<br>


<b>SUB_CAMERA_NUM<br>
</b>
サブカメラの個数を指定します．<br>
<br>
1に設定した場合、サブウィンドウは1つだけ表示されます．<br>
2に設定した場合、サブウィンドウは2つ表示されます．エージェントの左目からの画像が左のウィンドウに、右目のそれが右のウィンドウに表示されます．<br>
<br>


<b>BACK_GROUND_COLOR<br>
</b>
メインウィンドウの背景色を指定します．<br>
<br>


<b>MSG_WINDOW_LIMIT_TEXT_SIZE<br>
</b>
メッセージウィンドウに表示できる最大の文字数を指定します．0を指定すると最大値(=2GBytes)まで表示します．通常は0にしておけばよいでしょう．<br>
<br>


<b>SYS_MSG_WINDOW_LIMIT_TEXT_SIZE<br>
</b>
上記と同様にシステムメッセージウィンドウの文字数を制限します．<br>
<br>


<b>ATTR_NAMES_TO_SHOW<br>
</b>
画面右側の「Attribute」パネルで表示する属性名を指定します．
何も指定しない場合は，すべての属性が表示されます．<br>
<br>


<b>LOG_LEVEL<br>
</b>
ビューアの実行ログファイル(SIGViewer.log)を生成するか否かのフラグです．<br>
<br>
allの場合、ログが出力されます<br>
noneの場合、ログは出力されません（設定ファイルの記述内容のみは出力されます）<br>
<br>

<b>SHOW_GROUND_GRID<br>
</b>
床のグリッドを表示するか否かを制御します．デフォルトでは表示します．<br>
<br>


<b>GROUND_GRID_PLANE_SIZE<br>
</b>
床のグリッドの幅を指定します．デフォルトでは500です．<br>
<br>


<b>GROUND_GRID_SIZE<br>
</b>
床のグリッドのメッシュ間隔を指定します．デフォルトでは10です．<br>
<br>


<b>SHOW_AXIS_ARROW<br>
</b>
x, y, z軸を示す矢印を表示するか否かを制御します．デフォルトでは表示します．<br>
<br>


<b>AXIS_ARROW_LENGTH<br>
</b>
上記矢印の長さを指定します．デフォルトでは10です．<br>
<br>


<b>SHOW_DIR_ARROW<br>
</b>
エージェントの顔、左目、右目の方向を示す矢印を表示するか否かを制御します．<br>
<br>
顔の方向=1<br>
左目の方向=2<br>
右目の方向=4<br>
<br>
です．これらの数値の和を設定します．<br>
<br>
例えば、顔の方向のみ表示したい場合は1に設定します．左目と右目両方の方向を表示したい場合は6に設定します．<br>
<br>


<b>VIDEO_RECORD_RATE<br>
</b>
ビデオ録画時のフレーム間隔をミリ秒単位で指定します．デフォルトでは500です．<br>
<br>


<b>VIDEO_RECORD_COMPRESS<br>
</b>
ビデオ録画ファイル(.svd)を圧縮するか否かを制御します．デフォルト値はtrue（圧縮する）です．<br>
<br>


<p>また、行の先頭が#で始まる行は、コメントとみなされます．<br>
<br>
<br>
<br>
[startup.cfgファイルの例]<br>
<br>
<font class="example2"><b>
# ***************************************************<br>
#<br>
#	SIGViewer設定ファイル<br>
#<br>
# ***************************************************<br>
<br>
# ------------------------------------------------<br>
#  シミュレーションサーバーのホスト名とポート番号<br>
#<br>
#  この2つに限り、複数個のエントリを設定できる<br>
# ------------------------------------------------<br>
SERVER=localhost<br>
SERVER=myserver.mycompany.co.jp<br>
PORT=7000<br>
PORT=7010<br>
PORT=7020<br>
<br>
<br>
# ---------------------------------------------------<br>
#  SIGViewerのサービスプロバイダ関連の設定<br>
# ---------------------------------------------------<br>
<br>
# SIGViewerをサービスプロバイダとして登録するか<br>
VIEWER_AS_SERVICE_PROVIDER=true<br>
<br>
# サービスを受け付けるホストアドレス<br>
# この項目を指定しない場合は、自動的にSIGViewerを実行している<br>
# マシンのIPアドレスになる．<br>
#SERVICE_PROVIDER_HOST=127.0.0.1<br>
<br>
# サービスを受け付けるポート番号<br>
SERVICE_PROVIDER_PORT=8000<br>
<br>
<br>
# ------------------------------------------------<br>
#  メインカメラの位置と視線方向<br>
# ------------------------------------------------<br>
MAIN_CAMERA_INIT_POS=(30, 20, 50)<br>
MAIN_CAMERA_INIT_DIR=(-30, -20, -50)<br>
<br>
<br>
# ------------------------------------------------<br>
#  サブカメラの個数（単眼=1 or 複眼=2）<br>
# ------------------------------------------------<br>
SUB_CAMERA_NUM=1<br>
<br>
<br>
# ------------------------------------------------<br>
#  スクリーン背景色<br>
#  R, G, Bの色成分値(0.0以上1.0以下）で与える<br>
# ------------------------------------------------<br>
BACK_GROUND_COLOR=(0.7, 0.7, 0.8)<br>
<br>
<br>
# ------------------------------------------------<br>
#  メッセージ表示領域に表示する最大文字数<br>
#<br>
#  0 (default) = max size (2G chars)<br>
# ------------------------------------------------<br>
MSG_WINDOW_LIMIT_TEXT_SIZE=0<br>
SYS_MSG_WINDOW_LIMIT_TEXT_SIZE=0<br>
<br>
<br>
# ------------------------------------------------<br>
#  属性表示領域に表示する属性名<br>
#<br>
#  何も指定しないと、すべての属性を表示する<br>
# ------------------------------------------------<br>
ATTR_NAMES_TO_SHOW=(name, class, x, y, z, qw, qx, qy, qz, vpx, vpy, vpz, vvx, vvy, vvz, scalex, sca<br>ley, scalez, x3dCenterOfMass, visStateAttrName, switch, visual)<br>
<br>
<br>
# ------------------------------------------------<br>
#  SIGVerseシステムログ表示レベル<br>
#<br>
#  all ...... ログをSIGVerse.logに出力<br>
#  none ..... SIGVerse.logへのログ出力を行わない<br>
# ------------------------------------------------<br>
LOG_LEVEL=all<br>
<br>
<br>
# ------------------------------------------------<br>
#  地面グリッドの表示スイッチ<br>
# ------------------------------------------------<br>
SHOW_GROUND_GRID=true<br>
<br>
<br>
# ------------------------------------------------<br>
#  地面グリッドのサイズ<br>
# ------------------------------------------------<br>
GROUND_GRID_PLANE_SIZE=500<br>
GROUND_GRID_SIZE=10<br>
<br>
<br>
# ------------------------------------------------<br>
#  x, y, z軸矢印の表示スイッチ<br>
# ------------------------------------------------<br>
SHOW_AXIS_ARROW=true<br>
<br>
<br>
# ------------------------------------------------<br>
#  x, y, z軸矢印の長さ<br>
# ------------------------------------------------<br>
AXIS_ARROW_LENGTH=10<br>
<br>
<br>
# ------------------------------------------------<br>
#  視点矢印表示スイッチ<br>
#<br>
#  表示したい矢印に対応する以下の値の和を設定する．<br>
#<br>
#  1 = ビューベクトル((vpx, vpy, vpz)および(vvx, vvy, vvz)で決定)<br>
#  2 = 左目ベクトル((lepx, lepy, lepz)および(levx, levy, levz)で決定)<br>
#  4 = 右目ベクトル((repx, repy, repz)および(revx, revy, revz)で決定)<br>
#<br>
#  (ex)<br>
#  SHOW_DIR_ARROW = 1 （ビューベクトルのみ表示）<br>
#  SHOW_DIR_ARROW = 6 （左目、右目ベクトルを表示）<br>
# ------------------------------------------------<br>
#SHOW_DIR_ARROW = 7<br>
<br>
<br>
# ------------------------------------------------<br>
#  ビデオ記録レート（単位：msec）<br>
# ------------------------------------------------<br>
VIDEO_RECORD_RATE=500<br>
<br>
<br>
# ------------------------------------------------<br>
#  ビデオ記録時のファイル圧縮フラグ<br>
# ------------------------------------------------<br>
VIDEO_RECORD_COMPRESS=true<br>
<br>
</b>
</font><br>
（注）<br>
SIGViewer.exeのコマンドライン起動オプションとstartup.cfgが同時に指定された場合は、コマンドライン起動オプションの設定が優先されます．<br>
<p>
</p>
<br><br><br>
<a name="Java VM設定ファイル"><h3>Java VM設定ファイル</h3></a>

<p>シミュレーションサーバと同様に、ビューア（および世界エディタ）も、形状パース時にJava VMを起動します．</p>

<p>ビューアおよび世界エディタの使用する形状パーサー設定ファイル(X3DParser.cfg)は、ビューア(SIGViewer.exe)、世界エディタ(SIGWorldEditor.exe)と同一のディレクトリにあります.</p>

<p>設定項目はサーバーの場合と同じです．シミュレーションサーバのJava VM設定ファイルの項目を参照してください</p>

<br><br><br>

<a name="ファイアーウォール越え"><h3>ビューワーのサービスプロバイダ機能をファイアーウォールを越えて使う方法</h3></a>

<p>
サーバーが遠隔地にあり、ビューワーとの間のネットワークがファイアーウォールで隔てられている場合、ビューワーの提供するサービス(detectEntities, captureView等)がコントローラからアクセスできない場合があります．
</p>

<p>
この場合、sshトンネリングを用いて、ファイアーウォールを越えることができます．
</p>

<p>
設定は以下のようにします．
</p>
<pre>
[startup.cfg]

# ビューワーがサービスを提供することを、サーバーに登録するようにします．
VIEWER_AS_SERVICE_PROVIDER=true

# サービスを受け付けるPCのホストアドレスをlocalhost(127.0.0.1)にします
SERVICE_PROVIDER_HOST=127.0.0.1

# サービスを受け付けるポート番号を指定します
SERVICE_PROVIDER_PORT=8000
</pre>

次に、ビューワーを実行するPC上で、sshクライアントを起動し、サーバーとの間でsshトンネリング接続を確立します．（以下はPC上のcygwinを使用した場合）

<pre>
$ ssh -i id_rsa &lt;server-host-name&gt; -L 7000:localhost:7000 -R 8000:localhost:8000 -N
</pre>

<p>
sshトンネリング接続が確立したら、ビューアを起動し、サーバーのアドレスをlocalhostに設定し、ポート番号は7000番に指定してサーバーに接続します．
</p>

<p align="center">
<img border="0" src="viewer_firewall1.jpg">

<p>
コントローラがdetectEntities等のサービスをコールした場合、localhost（＝サーバー）の8000番に接続要求が行われますが、sshトンネリングにより、この接続要求がビューワーを実行しているPCの8000番に転送されます．</p>

<p>
この方法で、ファイアーウォールで隔てられているサーバー/ビューアー間でもdetectEntities等のサービスを使うことができます．
</p>

<hr><address style="align: right;"><a href="http://www.msi.co.jp"><img src="msilogo.gif" align="middle" border=0

width=139 height=53>（株）数理システム</a>

</body>

</html>
